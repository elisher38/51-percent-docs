<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>ETC / 51</title>

    <link rel="stylesheet" href="./assets/styles/main.css">
</head>

<body>
<div class="wrapper">
    <header>
        <h1>Risk Evaluation of 51-Percent Attacks on Ethereum Classic</h1>

        <p>This document provides an analysis of the context and estimates of risk of forged finality fraud (51-percent
            attacks) on Ethereum Classic (ETC).</p>
    </header>
    <main>

        <h1>Summary</h1>

        <p>The following chart and table provide rough estimates for expected attack costs and revenues.
            Current hashrate is not used in calculating the table's values.
            The <code>Net with MESS (USD)</code> column can be understood as a minimum payout
            from fraud that the attacker would need to break even given the cost of the attack.
        </p>


        <input type="number" name="block-reward" id="block-reward">
        <label for="block-reward">Block Reward (ETC)</label>
        <br>
        <input type="number" name="usd-etc" id="usd-etc">
        <label for="usd-etc">USD : ETC</label>
        <br>
        <input type="number" name="hashrate-rental-cost" id="hashrate-rental-cost">
        <label for="hashrate-rental-cost">Hashrate Rental Cost</label>

        <canvas id="myChart" width="400" height="200"></canvas>

        <table id="summary-table">
            <tr class="header">
                <th>Duration (HH:MM)</th>
                <th>Number of Blocks</th>
                <th>Expense (w/o MESS) (USD)</th>
                <th>Revenue (USD)</th>
                <th>Net (USD)</th>
                <th>MESS Penalty</th>
                <th>Expense with MESS (USD)</th>
                <th>Net with MESS (USD)</th>
            </tr>
        </table>

        <h2 id="what-a-51-percent-attack-is">What a 51-percent attack is</h2>
        <p>A “51% attack” is a scheme in which an “attacker” commits fraud against some victim, with the attacker
            renegging on their side of some transaction after receiving a counterparty’s corresponding payment.</p>
        <p>They do this by secretly mining a chain which critically omits the depositing transaction to the
            counterparty. Once the attacker receives the victim’s side of the exchange (which was predicated on the
            attacker’s deposit), the attacker publishes their chain, invalidating their end of the bargain.</p>
        <p>History is rewritten, and the attacker has received something for nothing, less the cost of carrying out the
            scheme.</p>

        <h2>Hardware Availability</h2>

        <p>
            While a theoretical cost can be derived for arbitrary hashrates,
            actual hardware resource availability is both extremely difficult to estimate,
            and a very important limitation for the attack strategy.
        </p>

        <h3 id="etc-daggerhashimoto-etchash">
            Mining Algorithm
        </h3>
        <p>
            The original mining algorithm <code>DaggerHashimoto</code>, still in use today by Ethereum,
            has been changed to <code>etchash</code> on Ethereum Classic.
        </p>
        <p>
            At block 11_700_000 (2020 November 28), Ethereum Classic implemented <a
                href="https://github.com/ethereumclassic/ECIPs/blob/master/_specs/ecip-1099.md/">ECIP-1099</a>,
            extending the Hashimoto DAG epoch length by a factor of 2, and thus reducing the requirement for mining
            hardware memory allocation, which had recently exceeded 4GB.
        </p>
        <p>
            This change was and is expected to recover and increase hardware availability for the mining algorithm.
        </p>

        <p>
            It also had the side-effect of removing the Ethereum Classic mining protocol from defaults provided by
            on-demand hashrate marketplaces, notably <a href="https://www.nicehash.com/">Nicehash.com</a>.</p>
        <p>The hardware available for mining on ETC is now a <em>superset</em> of the hardware capable of mining ETH.
            This means that while the current hashrate on ETH must be considered to be representative of potentially
            applicable hardware to ETC, it is (probably) not solely representative of the universal hardware potential.
        </p>
        <p>The <code>etchash</code> algorithm is supported by various mining software; including but not limited to
            <code>PhoenixMiner</code>, <code>T-Rex</code>, <code>Gminer</code>, and <code>lolMiner</code>.<sup><a
                    href="https://2miners.com/blog/how-to-mine-ethereum-classic-etc-mining-and-profitability">2miners</a></sup>
        </p>
        <p><a href="https://whattomine.com/coins/162-etc-etchash">WhatToMine</a> provides a hardware cost/benefit
            analysis tool
            for ETC and <code>etchash</code>.</p>

        <h3>Potential Hashrate Estimates</h3>

        <p>
            If we consider only the hashrate on Ethereum, which is applicable to Ethereum Classic,
            we can estimate the entities in possession of sufficient hashrate to attack Ethereum Classic.
        </p>

        <p>
            The current hashrate on Ethereum is <code id="eth-hashrate-current"></code>.
            The current hashrate on Ethereum Classic is <code id="etc-hashrate-current"></code>.
            So the current applicable global hashrate is their sum: <code id="global-hashrate"></code>.
            So Ethereum Classic represents <span id="etc-global-hashrate-share"></span>
            of global, observable, ETH/ETC-compatible hashrate.
        </p>
        <p>
            Given the <a href="https://etherscan.io/stat/miner?range=7&blocktype=blocks">top miner shares on
            Ethereum</a>,
            we can annotate those miners on Ethereum whose hashrate is sufficient to attack Ethereum Classic.
        </p>

        <table id="eth-miners">
            <tr class="header">
                <th>Address</th>
                <th>Name</th>
                <th>Share ETH (%)</th>
                <th>~Hashrate (xETC)</th>
            </tr>
        </table>

        <h2 id="mess">MESS</h2>


        <p>MESS stands for “Modified Exponential Subjective Scoring.” MESS is a protocol strategy originally proposed by
            Vitalik Buterin and modified (slightly) by Isaac Ardis. It specification can be found at <a
                    href="https://github.com/ethereumclassic/ECIPs/blob/master/_specs/ecip-1100.md">ECIP-1100</a>.
        </p>
        <p>It was developed and implemented in reaction to a series of three 51-percent attacks occurring on ETC in
            August 2020 worth around 5 million USD. At this time, the hashrate on ETC was around 5 TH/s.</p>
        <p>MESS increases the cost of producing a competitive chain by opinionating the network clients toward their
            incumbent chain, at a rate (pseudo-exponentially) proportional to the length of the competitive chain
            segment.</p>

        <p>
        <blockquote>This all seems reasonable! <sup><a
                href="https://github.com/ethereumclassic/ECIPs/issues/374#issuecomment-694156719">@vbuterin</a></sup>
        </blockquote>
        </p>

        <h3 id="mess-effects">MESS Protocol</h3>

        <p>
            The "penalty" curve implemented by MESS is a function of the length (as timestamp difference) of the
            incumbent competitive chain segment. This curve is graphed below:
        </p>
        <div class="" style="text-align: center;">
            <img src="https://user-images.githubusercontent.com/45600330/181563591-38d25db3-8e6f-40fc-8e0d-2b3f9d0919ea.png"
                 alt="ecbp1100-polynomial" style="max-width: 400px; display: inline-block;"/>
        </div>

        <p>
            This curve expresses a unitless multiple imposed as a comparative demand on the competing chain segment
            Total Difficulty (TD). It is defined as a polynomial with a minimum value of 1
            (<code>f(0)=1</code>), and a maximum value of 31 (<code>f(25132)=31</code>).
            This polynomial is defined as follows, with <code>x</code> being the timestamp difference between a
            local head and the common ancestor (fork block).
        <pre><code class="prism language-js">const ecbp1100PolynomialVCurveFunctionDenominator = 128;
const ecbp1100PolynomialVXCap = 25132;
const ecbp1100PolynomialVHeight = ecbp1100PolynomialVCurveFunctionDenominator * 15 * 2;

export const ECBP1100_Polynomial = (x) => {
    if (x > ecbp1100PolynomialVXCap) x = ecbp1100PolynomialVXCap;

    let xa = 3 * (x ** 2);
    let xb = (2 * (x ** 3)) / ecbp1100PolynomialVXCap;
    let out = xa - xb;

    out = out * ecbp1100PolynomialVHeight;

    const xcap2 = ecbp1100PolynomialVXCap ** 2;
    out = out / xcap2;

    out = out + ecbp1100PolynomialVCurveFunctionDenominator;

    return out;
};

export const ECBP1100_Penalty = (x) => {
    return ECBP1100_Polynomial(x) / ecbp1100PolynomialVCurveFunctionDenominator;
}</code></pre>
        <br>
        This function is then implemented in client canon-arbitration rules as:
        <pre><code class="prism language-js">function isProposedCanonical(original, proposed, commonAncestor) {
        // Derive the MESS penalty.
        const messPenalty = ECBP1100_Penalty(original.timestamp - commonAncestor.timestamp);

        // Apply the penalty condition.
        if (messPenalty /* [1.0-31] */ * original.TD >= proposed.TD) {
            return false;
        }

        // Reaching here, the proposed segment should become canonical;
        // it has exceeded the TD demand imposed under MESS.
        return true;
}</code></pre>
        </p>

        <h5>Notes</h5>
        <p>These estimates are rough. Factors not taken into account include but are not
            limited to difficulty adjustment rates, potentially variable hashrate availability, nor any “luck” margin
            for the miner’s target total difficulty,</p>
        <p>
            The MESS penalty maxes out at 7 hours at a value of 31x.
        <blockquote>
            Having a cap at 32x or some value in that ballpark seems totally reasonable; you're right that there's no
            need to have the ratio keep increasing forever.
            <sup><a href="https://github.com/ethereumclassic/ECIPs/issues/374#issuecomment-694156719">
                @vbuterin
            </a></sup>
        </blockquote>
        </p>

        <h3>MESS Rationale</h3>

        <h4>Alternative Strategies</h4>

        Given a low hashrate relative to global comparable and applicable hashrate,
        Ethereum Classic considered several strategies to mitigate the risk of lower-than-desirable
        chain finality expectations.

        Among the strategies considered were:

        <ul>
            <li>Several <strong><a
                    href="https://github.com/ethereumclassic/ECIPs/blob/7c596137e88038fccc293f42a2a3d01c54c27c35/_specs/ecip-1097.md">checkpointing
                protocols</a></strong>, which depended on the assertion of an authority entity, implying the compromise
                of the core principle of decentralized and permissionless consensus.
            </li>
            <li>A <strong><a href="https://veriblock.org/">proof-of-proof protocol</a></strong> which delegated
                consensus to a third-party authority entity (ie. Bitcoin), which was not a participant in the original
                consensus protocol. Not only did this "export" trust(lessness) to a 3rd party, but would have required a
                burdensome amount of effort to implement satisfactorily.
            </li>
            <li>A <strong>peer-to-peer <a
                    href="https://github.com/ethereumclassic/ECIPs/blob/7d259a0f07c62604ab0bb75b1baeb1d00b32a687/_specs/ecip-1106.md">endorsement
                scheme</a></strong> intended to materialize practical heuristics about chain segment preference (ie.
                following established and human-trusted miners), but again, these compromised the rationale of the
                network's foundational principles.
            </li>
        </ul>

        Ultimately, <strong>MESS</strong> was selected for its simplicity, robustness, and closeness to core principles.

        <h4>MESS Discussion</h4>
        One participant in the discussion of MESS raised a concern as follows:
        <p>
        <blockquote>
            Your new solution improves the protection but still allows a different selfish mining attack. It requires
            more hashrate and very high network connectivity.
            <br><br>
            This is the attack:
            <br><br>
            We assume the attacker has two times (plus epsilon) the honest hashrate. Let's assume that the victim is
            waiting for C confirmations. So the attacker first starts mining a public chain A with 1-second intervals
            and with a hashrate that exceeds the honest hashrate. But he keeps mining his blocks in private. If the
            honest miners create a block on top of A, then the attacker releases immediately one of his private blocks
            so that nodes see the attacker block before the honest block, and therefore all the blocks in fork A will be
            generated by the attacker, and always the timestamp of the best block in A will be in the past.
            This is a 51% attack combined by a selfish-mining attack.
            <br><br>
            At the same time the attacker is mining a fork B with more hashrate than A. This fork has normal timestamps
            (or past timestamps, it doesn't matter). When the fork A is C blocks in length (and the victim has already
            confirmed the double-spent transaction) he leaves fork A and reveals fork B. Nodes will apply a very low
            penalty on B because the best block in A has a timestamp that is 10 times closer to the common ancestor than
            what is expected.
            <br><br>
            While this attack requires much more resources (2X the hashrate and higher control over the network), it's
            still possible.
            <br><br>
            My proposal of the availability rule would not accept fork A as valid in the first place, and therefore the
            double-spend transaction will never be confirmed in fork A.
            <sup><a href="https://github.com/ethereumclassic/ECIPs/issues/374#issuecomment-699152317">@SergioDemianLerner</a></sup>
        </blockquote>
        </p>

        <p>
            A close look at the reasoning here discovers critical issues with the argument, and shows that even in spite of them, the practical demands for a successful attack are very great.

        <ul>
            <li>If <span class="q">the attacker has two times the public hashrate</span>, and must mine the public chain as well as a
                competitive chain simultaneously, it stands to reason that their assumed hashrate will be insufficient.
                If the attacker spends half of their available hashrate (<code>(2*publicHashrate+e)/2</code>) mining the
                public chain, the resulting hashrate on the public chain will be <code>2*publicHashrate</code>, while
                the attacker will have only <code>1*public hashrate</code> to spend building the private competing
                segment.
            </li>
            <li><span class="q">If the honest miners create a block on top of A, then the attacker releases immediately one of his
                private blocks so that nodes see the attacker block before the honest block, and therefore all the
                blocks in fork A will be generated by the attacker.</span> Here, the commenter is confused about how
                "releasing blocks" from the private chain works. If indeed the attacker convinces the public network
                that their private chain is canonical, allowing him to mine all the blocks on the public chain, then it
                is obvious that the private chain is no longer private, and in fact has become public and canonical.
            </li>
            <li>Generally, the feature where <span class="q">[the attacker] releases [...] one of his private blocks so that nodes see the attacker block before the honest block</span> would be practically extraordinarily difficult to implement, required a comprehensive view and control of the global, decentralized, permissionless network. An attack of this variety and magnitude would effectively become a network-wide <a href="https://en.wikipedia.org/wiki/Sybil_attack">Sybil attack</a>.
            </li>
        </ul>
        </p>

        <h3 id="mess-vulnerabilities">MESS Known Vulnerabilities</h3>
        <p>Because the MESS protocol induces nodes to act decisively on an evaluation of a subjective data point (local
            head), network consensus is vulnerable to bifurcation under circumstances which are expected to be rare, or
            difficult to achieve (from an attacker’s persepctive: <em>costly</em>).</p>
        <p>An effort has been made to quantify the expected cost of such a vulnerability. This effort from December 2020
            estimated the cost at around “20_000 USD upfront, and 5_000 USD per month to maintain the split.” <sup><a
                    href="./MESS%20Exploit%20Details%20and%20Simulation.pdf">Veriblock v1</a></sup> At this time, ETC
            had a network hashrate around 5Th/s.</p>
        <p>It is my opinion on this work that the model it bases its findings on is naive and occassionally incorrect,
            and that its claims are underestimates (since, at least, complexity is probably expensive).</p>
        <p>Of further note is that this vulnerability is <em>a different category</em> of vulnerability than a
            51-percent attack. Where the 51-percent scheme is a scenario pitting a fraudster against one or a few
            victims, the vulnerability resulting from the mechanics of the MESS protocol is nearer in spirit to
            terrorism (or a controlled market short) since bifurcating the network would likely destroy its value.</p>

        <h2 id="derivation-of-cost-values">Derivation of Cost Values</h2>
        <p>Since marketplace prices for ETC-compatible have become murky with the omission of <code>etchash</code> from
            popular on-demand hashrate marketplaces, we must assume the task of building an estimate for ETC-compatible
            hashrate cost. To do so, we build from a general economic intuition that the cost of hashrate should be
            slightly (or somewhat) less than the revenue it earns. If the costs exceeded the revenue, miners would not
            be incentived to commit work to the chain. If the revenue dramatically exceeded the costs, hashrate would
            rise with increased competition for the spoils of the market inefficiency.</p>
        <p>Given these constraints, we provide a sort of reverse-engineered estimation of ETC’s hashing cost using
            publicly available information for ETC’s younger sister, ETH.</p>
        <p>We first show that a cost estimate is close to an expected potential revenue.</p>
        <p>If ETH’s hashrate is 929.397 TH/s and the cost of marketplace DaggerHashimoto hashrate is 0.99 BTC/TH/24h and
            the ETH:BTC exchange rate is 0.07127 then the cost of marketplace DaggerHashimoto hashrate in ETH is <code>0.99
                * (1/0.07127=14) = 13.9</code> ETH/TH/24h</p>
        <p>At these rates, the cost of an equilibrium chain would be at least matching its current hashrate at the
            current hashrate price 929.397 * 13.9 ETH/24h = 12910.1 ETH / 24h</p>
        <p>ETH’s block time is 13.5 seconds yielding (24<em>60</em>60 seconds / 24hr = 86400 seconds / 13.5 seconds =
            6400 blocks / day) ETH’s block reward is 2 ETH / block. <sup><a
                    href="https://github.com/ethereum/go-ethereum/blob/d8f963811df6ef97c76c9b4f433bf0bc936051e2/consensus/ethash/consensus.go#L44">Source</a></sup>
        </p>
        <p>The ETH token currency inflates at at least 6400 blocks * 2 ETH per day = 12800 ETH per day. A competitive
            chain could be built at a cost of 12910.1 ETH / day if hashrate were purchased in the on-demand marketplace
            considered.</p>
        <p>This analysis seems to fit our bespoke intuitive expectations for price vs. revenue models in a competitive
            and efficient market.</p>
        <p>We now apply this validated intuition as a heuristic for ETC’s hashing cost.</p>
        <p>ETC’s block time is roughly the same as ETH’s (though slightly faster because of relatively greater
            Difficulty volatility), so ETC also produces 6400 blocks / day.</p>
        <p>ETC’s block reward is 2.56 ETC, so ETC inflates at least <code>2.56 * 6400 = 16384</code> ETC / day.</p>
        <p>If we assume that the revenue should roughly match the production cost in ETC as it seems to in ETH then we
            could expect a mining cost of 16384 ETC * 36 USD/ETC = 589_824 USD / day, or 24_576 USD / hr.</p>

        <h4 id="rationale-limits">Rationale Limits</h4>
        <p>The accuracy of the estimate derived above is limited by a lack of knowledge about
        <ul>
            <li>Universal compatible hardware availability (increased theoretically by ECIP-1099, but “in dark
                garages”)
            </li>
            <li>Private or obscure hashrate marketplaces</li>
        </ul>
        </p>

    </main>
    <hr>
    <footer>
        Website source:&nbsp;<a href="https://github.com/meowsbits/51-percent-docs">https://github.com/meowsbits/51-percent-docs</a>
    </footer>
</div>
<script src="./assets/scripts/bundle.js"></script>
</body>

</html>
